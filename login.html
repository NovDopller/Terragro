<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Login - Sistema Agrícola</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-green-100 via-white to-green-200 min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md rounded-3xl shadow-2xl bg-white/90 backdrop-blur-md border-2 border-green-200 p-8">
    <div class="flex flex-col items-center">
      <img src="Logo.png" alt="Logo da Empresa" class="h-24 object-contain drop-shadow-xl mb-6">
      <h2 id="formTitle" class="text-4xl font-extrabold text-green-700 mb-4">Login</h2>
      <span class="text-green-900 font-light text-lg mb-6 text-center">Acesse o sistema agrícola</span>
    </div>
    <!-- Login Form -->
    <form id="loginForm" class="space-y-6">
      <input type="text" id="loginUser" placeholder="Usuário" class="w-full border-2 border-gray-700 rounded-2xl px-6 py-4 focus:outline-none text-lg" autocomplete="username">
      <input type="password" id="loginPass" placeholder="Senha" class="w-full border-2 border-gray-700 rounded-2xl px-6 py-4 focus:outline-none text-lg" autocomplete="current-password">
      <button type="submit" class="w-full bg-green-700 hover:bg-green-800 text-white font-extrabold py-4 rounded-2xl shadow-xl text-xl transition-all">
        Entrar
      </button>
      <div id="loginMsg" class="text-red-600 text-center"></div>
      <div class="text-center text-sm text-gray-700">
        Não tem cadastro? <a href="#" id="toRegister" class="text-green-700 font-bold underline">Criar uma conta</a>
      </div>
    </form>
    <!-- Cadastro Form -->
    <form id="registerForm" class="space-y-6 hidden">
      <input type="text" id="registerUser" placeholder="Novo usuário" class="w-full border-2 border-gray-700 rounded-2xl px-6 py-4 focus:outline-none text-lg" autocomplete="username">
      <input type="password" id="registerPass" placeholder="Nova senha" class="w-full border-2 border-gray-700 rounded-2xl px-6 py-4 focus:outline-none text-lg" autocomplete="new-password">
      <input type="password" id="registerPass2" placeholder="Repita a senha" class="w-full border-2 border-gray-700 rounded-2xl px-6 py-4 focus:outline-none text-lg" autocomplete="new-password">
      <button type="submit" class="w-full bg-green-700 hover:bg-green-800 text-white font-extrabold py-4 rounded-2xl shadow-xl text-xl transition-all">
        Cadastrar
      </button>
      <div id="registerMsg" class="text-red-600 text-center"></div>
      <div class="text-center text-sm text-gray-700">
        Já tem conta? <a href="#" id="toLogin" class="text-green-700 font-bold underline">Fazer login</a>
      </div>
    </form>
  </div>

  <script>
    const BASE_URL = "http://localhost:5000"; // Altere para o IP do servidor se não for local

    // Troca entre login/cadastro
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    document.getElementById('toRegister').onclick = e => {
      e.preventDefault();
      loginForm.classList.add('hidden');
      registerForm.classList.remove('hidden');
      document.getElementById('formTitle').textContent = 'Cadastro';
      document.getElementById('loginMsg').textContent = '';
    };
    document.getElementById('toLogin').onclick = e => {
      e.preventDefault();
      registerForm.classList.add('hidden');
      loginForm.classList.remove('hidden');
      document.getElementById('formTitle').textContent = 'Login';
      document.getElementById('registerMsg').textContent = '';
    };

    // Cadastro
    registerForm.onsubmit = async function(e) {
      e.preventDefault();
      const user = document.getElementById('registerUser').value.trim();
      const pass = document.getElementById('registerPass').value;
      const pass2 = document.getElementById('registerPass2').value;
      if (!user || !pass || !pass2) {
        document.getElementById('registerMsg').textContent = 'Preencha todos os campos.';
        return;
      }
      if (pass !== pass2) {
        document.getElementById('registerMsg').textContent = 'As senhas não coincidem.';
        return;
      }
      const resp = await fetch(BASE_URL + '/api/cadastrar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ usuario: user, senha: pass })
      });
      const data = await resp.json();
      if (resp.ok) {
        document.getElementById('registerMsg').textContent = 'Cadastro realizado! Agora faça login.';
        setTimeout(() => {
          document.getElementById('toLogin').click();
        }, 1200);
      } else {
        document.getElementById('registerMsg').textContent = data.msg;
      }
    };

    // Login
    loginForm.onsubmit = async function(e) {
      e.preventDefault();
      const user = document.getElementById('loginUser').value.trim();
      const pass = document.getElementById('loginPass').value;
      const resp = await fetch(BASE_URL + '/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ usuario: user, senha: pass })
      });
      if (resp.ok) {
        sessionStorage.setItem('loggedIn', 'true');
        sessionStorage.setItem('loggedUser', user);
        window.location.href = 'index.html';
      } else {
        const data = await resp.json();
        document.getElementById('loginMsg').textContent = data.msg || 'Usuário ou senha inválidos!';
      }
    };
  </script>
</body>
</html>

